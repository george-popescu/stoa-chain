---
phase: 06-regenerate-genesis-payloads-with-updated-multi-sig-governance-new-modules-and-2026-02-24t19-00-00z-genesis-time
plan: 02
type: execute
wave: 2
depends_on:
  - "06-01"
files_modified:
  - cwtools/ea/Ea/Genesis.hs
  - src/Chainweb/BlockHeader/Genesis/Stoa0Payload.hs
  - src/Chainweb/BlockHeader/Genesis/Stoa1to9Payload.hs
autonomous: true
requirements:
  - GEN-06
must_haves:
  truths:
    - "Ea tool runs successfully generating new genesis payloads for all 10 chains"
    - "stoa0 Genesis record uses 5-element _coinContract list with chain-0 YAML for tx4"
    - "stoaN Genesis record uses 5-element _coinContract list with chains-1-9 YAML for tx4"
    - "cabal build chainweb-node compiles with zero warnings"
  artifacts:
    - path: "cwtools/ea/Ea/Genesis.hs"
      provides: "Updated stoa0 and stoaN Genesis records with 5-transaction architecture"
      contains: "stoa-genesis-5.yaml"
    - path: "src/Chainweb/BlockHeader/Genesis/Stoa0Payload.hs"
      provides: "Auto-generated genesis payload for chain 0 (5 transactions)"
      contains: "payloadBlock"
    - path: "src/Chainweb/BlockHeader/Genesis/Stoa1to9Payload.hs"
      provides: "Auto-generated genesis payload for chains 1-9 (5 transactions)"
      contains: "payloadBlock"
  key_links:
    - from: "cwtools/ea/Ea/Genesis.hs"
      to: "pact/genesis/stoa/stoa-genesis-*.yaml"
      via: "_coinContract list referencing YAML file paths"
      pattern: "pact/genesis/stoa/stoa-genesis-"
    - from: "src/Chainweb/Version/Stoa.hs"
      to: "src/Chainweb/BlockHeader/Genesis/Stoa0Payload.hs"
      via: "_genesisBlockPayload imports payload module"
      pattern: "S0.payloadBlock"
---

<objective>
Update the Ea Genesis records to use the new 5-transaction architecture, run the Ea tool to regenerate genesis payloads, and verify the full build compiles.

Purpose: Wire the new pact files and YAML wrappers into the Ea tool's Genesis records so that `cabal run ea` produces the new genesis payload Haskell modules with the updated multi-sig governance, namespaced interfaces, and correct genesis time.

Output: Updated Ea/Genesis.hs, regenerated Stoa0Payload.hs and Stoa1to9Payload.hs, successful build.
</objective>

<execution_context>
@/Users/codera/.claude/get-shit-done/workflows/execute-plan.md
@/Users/codera/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-regenerate-genesis-payloads-with-updated-multi-sig-governance-new-modules-and-2026-02-24t19-00-00z-genesis-time/06-RESEARCH.md
@.planning/phases/06-regenerate-genesis-payloads-with-updated-multi-sig-governance-new-modules-and-2026-02-24t19-00-00z-genesis-time/06-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Ea Genesis records for 5-transaction architecture</name>
  <files>
    cwtools/ea/Ea/Genesis.hs
  </files>
  <action>
    Replace the Stoa section in `cwtools/ea/Ea/Genesis.hs` (lines ~242-274). The key change: move from using `_coinbase`, `_keysets`, `_namespaces` as separate fields to putting ALL 5 transactions into `_coinContract` list. All other Genesis fields become `Nothing`.

    Replace the old Stoa constants and records:

    ```haskell
    -- ---------------------------------------------------------------------- --
    -- Stoa

    stoa0 :: Genesis
    stoa0 = Genesis
        { _version = Stoa
        , _tag = "Stoa"
        , _txChainIds = onlyChainId 0
        , _coinbase = Nothing
        , _keysets = Nothing
        , _allocations = Nothing
        , _namespaces = Nothing
        , _coinContract =
            [ "pact/genesis/stoa/stoa-genesis-1.yaml"
            , "pact/genesis/stoa/stoa-genesis-2.yaml"
            , "pact/genesis/stoa/stoa-genesis-3.yaml"
            , "pact/genesis/stoa/stoa-genesis-4-chain0.yaml"
            , "pact/genesis/stoa/stoa-genesis-5.yaml"
            ]
        }

    stoaN :: Genesis
    stoaN = stoa0
        & txChainIds .~ mkChainIdRange 1 9
        & coinContract .~
            [ "pact/genesis/stoa/stoa-genesis-1.yaml"
            , "pact/genesis/stoa/stoa-genesis-2.yaml"
            , "pact/genesis/stoa/stoa-genesis-3.yaml"
            , "pact/genesis/stoa/stoa-genesis-4-chains1-9.yaml"
            , "pact/genesis/stoa/stoa-genesis-5.yaml"
            ]
    ```

    Remove the old filepath constants that are no longer needed:
    - `stoaCoinContract` (was "pact/genesis/stoa/load-stoa-coin.yaml")
    - `stoaNs` (was "pact/genesis/stoa/ns.yaml")
    - `stoaKeysets` (was "pact/genesis/stoa/keysets.yaml")
    - `stoaInitChain0` (was "pact/genesis/stoa/init-chain0.yaml")

    The transaction ordering in `_coinContract` is critical:
    1. tx1: ns module + registry + namespaces
    2. tx2: interfaces + stoic-predicates + keysets 1-7
    3. tx3: util.guards + util.gas-guards
    4. tx4: coin module (chain-0 with init, chains-1-9 without)
    5. tx5: stoic-xchain + xchain gas accounts

    The Ea tool processes `_coinContract` first, then `_namespaces`, `_keysets`, `_allocations`, `_coinbase`. Since we set all optional fields to `Nothing`, only `_coinContract` matters — and its ordering is preserved.
  </action>
  <verify>
    - `grep -c "stoa-genesis-" cwtools/ea/Ea/Genesis.hs` should show references to 5 yaml files per record
    - `grep "stoaCoinContract\|stoaNs\|stoaKeysets\|stoaInitChain0" cwtools/ea/Ea/Genesis.hs` should produce NO output (old constants removed)
    - `grep "_coinbase = Nothing" cwtools/ea/Ea/Genesis.hs` should match in the stoa0 record
    - The module should still export `stoa0` and `stoaN`
  </verify>
  <done>stoa0 and stoaN Genesis records use 5-element _coinContract lists. stoa0 uses stoa-genesis-4-chain0.yaml, stoaN uses stoa-genesis-4-chains1-9.yaml. All other Genesis fields are Nothing. Old filepath constants removed.</done>
</task>

<task type="auto">
  <name>Task 2: Run Ea tool, rebuild chainweb-node, verify compilation</name>
  <files>
    src/Chainweb/BlockHeader/Genesis/Stoa0Payload.hs
    src/Chainweb/BlockHeader/Genesis/Stoa1to9Payload.hs
  </files>
  <action>
    1. Build and run the Ea tool to regenerate genesis payloads:
       ```bash
       cd /Users/codera/Development/Stoa/stoa-chain
       cabal run ea
       ```
       This will:
       - Read all 5 YAML files per Genesis record
       - Load the pact files and JSON data files
       - Execute each transaction in a fresh Pact/RocksDB environment
       - Generate `Stoa0Payload.hs` and `Stoa1to9Payload.hs`

       If the ea tool fails:
       - Check error message for which transaction failed
       - Common issues: YAML path resolution, missing data keys, predicate resolution timing
       - If tx5 (stoic-xchain) fails on governance: investigate whether `keyPairs: []` works for this new module (it worked for coin module in Phase 3)

    2. After successful Ea run, build the full project:
       ```bash
       cabal build chainweb-node
       ```
       This compiles with `-Wall -Werror -Wcompat`. Must produce zero warnings.

    3. Verify the generated payload files exist and have been updated:
       - `src/Chainweb/BlockHeader/Genesis/Stoa0Payload.hs` should have a recent timestamp
       - `src/Chainweb/BlockHeader/Genesis/Stoa1to9Payload.hs` should have a recent timestamp
       - Both should contain `payloadBlock` definitions

    4. The old YAML files (`load-stoa-coin.yaml`, `ns.yaml`, `keysets.yaml`, `init-chain0.yaml`) can be left in place — they are no longer referenced by any Genesis record. Removing them is optional cleanup.
  </action>
  <verify>
    - `cabal run ea` exits with code 0
    - `cabal build chainweb-node` exits with code 0 (zero warnings under -Werror)
    - `ls -la src/Chainweb/BlockHeader/Genesis/Stoa0Payload.hs` shows recent modification time
    - `ls -la src/Chainweb/BlockHeader/Genesis/Stoa1to9Payload.hs` shows recent modification time
    - Both payload files contain `module Chainweb.BlockHeader.Genesis.Stoa` prefix
  </verify>
  <done>Ea tool successfully generates new genesis payloads. Both Stoa0Payload.hs and Stoa1to9Payload.hs are regenerated with the 5-transaction genesis. cabal build chainweb-node compiles with zero warnings.</done>
</task>

</tasks>

<verification>
1. Ea tool: `cabal run ea` succeeds, producing Stoa0Payload.hs and Stoa1to9Payload.hs
2. Build: `cabal build chainweb-node` succeeds with zero warnings
3. Genesis records: stoa0 uses 5-tx list with chain-0 tx4, stoaN uses 5-tx list with chains-1-9 tx4
4. Payload content: generated Haskell modules contain encoded 5-transaction payloads
5. Old constants: stoaCoinContract, stoaNs, stoaKeysets, stoaInitChain0 are removed from Genesis.hs
</verification>

<success_criteria>
- Ea tool generates payloads without errors
- Full project build with zero warnings
- Genesis payload modules reflect the new 5-transaction architecture
- Node binary is ready for deployment
</success_criteria>

<output>
After completion, create `.planning/phases/06-regenerate-genesis-payloads-with-updated-multi-sig-governance-new-modules-and-2026-02-24t19-00-00z-genesis-time/06-02-SUMMARY.md`
</output>
